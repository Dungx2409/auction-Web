<section class="account-section account-admin" data-admin-dashboard data-current-user-id="{{user.id}}">
  <header class="section-header">
    <h2>B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n tr·ªã</h2>
    <div class="stats-strip">
      <div><strong>{{admin.stats.totalProducts}}</strong><span> S·∫£n ph·∫©m</span></div>
      <div><strong>{{admin.stats.totalCategories}}</strong><span> Danh m·ª•c con</span></div>
      <div><strong>{{admin.stats.totalUsers}}</strong><span> Ng∆∞·ªùi d√πng</span></div>
      <div class="{{#if admin.stats.pendingUpgradeRequests}}has-pending{{/if}}">
        <strong>{{admin.stats.pendingUpgradeRequests}}</strong><span> Y√™u c·∫ßu n√¢ng c·∫•p</span>
      </div>
    </div>
  </header>

  {{#if admin.upgradeRequests.length}}
  <div class="admin-upgrade-requests" data-admin-upgrade-requests>
    <div class="admin-upgrade-header">
      <h3>Y√™u c·∫ßu n√¢ng c·∫•p t√†i kho·∫£n ch·ªù duy·ªát</h3>
      <span class="upgrade-count-badge">{{admin.upgradeRequests.length}}</span>
    </div>
    <div class="admin-upgrade-list">
      {{#each admin.upgradeRequests}}
      <div class="admin-upgrade-card" data-upgrade-request data-request-id="{{id}}" data-user-id="{{userId}}">
        <div class="upgrade-card-header">
          <div class="upgrade-user-info">
            <strong class="upgrade-user-name">{{user.name}}</strong>
            <span class="upgrade-user-email">{{user.email}}</span>
          </div>
          <div class="upgrade-user-rating">
            <span class="rating-badge">
              {{#if user.ratingPlus}}+{{user.ratingPlus}}{{else}}0{{/if}} / 
              {{#if user.ratingMinus}}-{{user.ratingMinus}}{{else}}0{{/if}}
            </span>
          </div>
        </div>
        <div class="upgrade-card-meta">
          <span class="upgrade-date">G·ª≠i l√∫c: {{formatDate requestDate 'DD/MM/YYYY HH:mm'}}</span>
          <span class="upgrade-member-since">Th√†nh vi√™n t·ª´: {{formatDate user.createdAt 'DD/MM/YYYY'}}</span>
        </div>
        <div class="upgrade-card-actions">
          <button type="button" class="btn-approve" data-upgrade-approve data-request-id="{{id}}">
            ‚úì Ph√™ duy·ªát
          </button>
          <button type="button" class="btn-reject" data-upgrade-reject data-request-id="{{id}}">
            ‚úï T·ª´ ch·ªëi
          </button>
        </div>
      </div>
      {{/each}}
    </div>
  </div>
  {{/if}}

  <!-- Category Management Section -->
  <div class="admin-category-management" data-admin-categories>
    <div class="admin-category-header">
      <h3>Qu·∫£n l√Ω danh m·ª•c</h3>
      <button type="button" class="btn primary btn-add-category" data-category-add-root>
        + Th√™m danh m·ª•c cha
      </button>
    </div>

    <div class="admin-category-list">
      {{#each admin.categoriesForAdmin}}
      <div class="admin-category-item is-parent" data-category-item data-category-id="{{id}}">
        <div class="category-item-header">
          <div class="category-item-info">
            <span class="category-icon">üìÅ</span>
            <strong class="category-name">{{name}}</strong>
            <span class="category-stats">
              {{#if totalProductCount}}({{totalProductCount}} s·∫£n ph·∫©m){{else}}(0 s·∫£n ph·∫©m){{/if}}
            </span>
          </div>
          <div class="category-item-actions">
            <button type="button" class="btn-icon btn-add-child" data-category-add-child data-parent-id="{{id}}" data-parent-name="{{name}}" title="Th√™m danh m·ª•c con">
              ‚ûï
            </button>
            <button type="button" class="btn-icon btn-edit" data-category-edit data-category-id="{{id}}" data-category-name="{{name}}" data-category-description="{{description}}" title="S·ª≠a">
              ‚úèÔ∏è
            </button>
            <button type="button" class="btn-icon btn-delete" data-category-delete data-category-id="{{id}}" data-category-name="{{name}}" {{#if children.length}}disabled title="X√≥a danh m·ª•c con tr∆∞·ªõc"{{else}}{{#if productCount}}disabled title="C√≥ s·∫£n ph·∫©m trong danh m·ª•c"{{else}}title="X√≥a"{{/if}}{{/if}}>
              üóëÔ∏è
            </button>
          </div>
        </div>
        {{#if children.length}}
        <div class="category-children">
          {{#each children}}
          <div class="admin-category-item is-child" data-category-item data-category-id="{{id}}" data-parent-id="{{../id}}">
            <div class="category-item-header">
              <div class="category-item-info">
                <span class="category-icon">üìÑ</span>
                <span class="category-name">{{name}}</span>
                <span class="category-stats">
                  {{#if productCount}}({{productCount}} s·∫£n ph·∫©m){{else}}(0 s·∫£n ph·∫©m){{/if}}
                </span>
              </div>
              <div class="category-item-actions">
                <button type="button" class="btn-icon btn-edit" data-category-edit data-category-id="{{id}}" data-category-name="{{name}}" data-category-description="{{description}}" data-parent-id="{{../id}}" title="S·ª≠a">
                  ‚úèÔ∏è
                </button>
                <button type="button" class="btn-icon btn-delete" data-category-delete data-category-id="{{id}}" data-category-name="{{name}}" {{#if productCount}}disabled title="C√≥ s·∫£n ph·∫©m trong danh m·ª•c"{{else}}title="X√≥a"{{/if}}>
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
          {{/each}}
        </div>
        {{/if}}
      </div>
      {{else}}
      <p class="admin-category-empty">Ch∆∞a c√≥ danh m·ª•c n√†o. H√£y th√™m danh m·ª•c ƒë·∫ßu ti√™n!</p>
      {{/each}}
    </div>
  </div>

  <!-- Category Modal -->
  <div class="modal-overlay" data-category-modal hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3 data-category-modal-title>Th√™m danh m·ª•c</h3>
        <button type="button" class="modal-close" data-category-modal-close>&times;</button>
      </div>
      <form class="modal-body" data-category-form>
        <input type="hidden" name="categoryId" data-category-form-id>
        <input type="hidden" name="parentId" data-category-form-parent-id>
        
        <div class="form-group">
          <label for="categoryName">T√™n danh m·ª•c <span class="required">*</span></label>
          <input type="text" id="categoryName" name="name" data-category-form-name required maxlength="100" placeholder="Nh·∫≠p t√™n danh m·ª•c">
        </div>
        
        <div class="form-group" data-category-parent-group>
          <label for="categoryParent">Danh m·ª•c cha</label>
          <select id="categoryParent" name="parentSelect" data-category-form-parent-select>
            <option value="">‚Äî Kh√¥ng (danh m·ª•c c·∫•p 1) ‚Äî</option>
            {{#each admin.parentCategories}}
            <option value="{{id}}">{{name}}</option>
            {{/each}}
          </select>
        </div>
        
        <div class="form-group">
          <label for="categoryDescription">M√¥ t·∫£</label>
          <textarea id="categoryDescription" name="description" data-category-form-description rows="3" maxlength="500" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ danh m·ª•c (t√πy ch·ªçn)"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn secondary" data-category-modal-close>H·ªßy</button>
          <button type="submit" class="btn primary" data-category-form-submit>L∆∞u</button>
        </div>
      </form>
    </div>
  </div>

  <div class="admin-management" data-admin-management>
    <!-- User List Panel -->
    <div class="admin-users-panel" data-admin-users-panel>
      <div class="admin-panel-header">
        <h3>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
      </div>
      <div class="admin-user-filters" data-admin-filter-group>
        <button type="button" class="admin-user-filter is-active" data-admin-filter="all">T·∫•t c·∫£
          ({{admin.userCounts.all}})</button>
        <button type="button" class="admin-user-filter" data-admin-filter="admin">Admin
          ({{admin.userCounts.admin}})</button>
        <button type="button" class="admin-user-filter" data-admin-filter="seller">Seller
          ({{admin.userCounts.seller}})</button>
        <button type="button" class="admin-user-filter" data-admin-filter="bidder">Bidder
          ({{admin.userCounts.bidder}})</button>
      </div>

      <div class="admin-user-table-wrapper">
        <table class="admin-user-table" data-admin-user-table>
          <thead>
            <tr>
              <th>T√™n</th>
              <th>Vai tr√≤</th>
              <th>Email</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Ng√†y tham gia</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            {{#each admin.users}}
            <tr class="admin-user-row{{#if (eq status 'banned')}} is-banned{{/if}}" data-admin-user
              data-user-id="{{id}}" data-role="{{role}}" data-user-name="{{name}}" data-user-email="{{email}}"
              data-user-role-label="{{#if (eq role 'admin')}}Admin{{else}}{{#if (eq role 'seller')}}Seller{{else}}Bidder{{/if}}{{/if}}"
              data-user-status="{{status}}" tabindex="0">
              <td>
                <span class="admin-user-name">{{name}}</span>
              </td>
              <td>{{#if (eq role 'admin')}}Admin{{else}}{{#if (eq role 'seller')}}Seller{{else}}Bidder{{/if}}{{/if}}
              </td>
              <td>{{email}}</td>
              <td>
                <span class="admin-user-status admin-user-status--{{status}}">
                  {{#if (eq status 'banned')}}
                  Locked
                  {{else}}
                  {{#if (eq status 'pending')}}
                  Pending approval
                  {{else}}
                  Active
                  {{/if}}
                  {{/if}}
                </span>
              </td>
              <td>{{formatDate createdAt 'DD/MM/YYYY'}}</td>
              <td>
                <button type="button" class="btn-view-detail" data-view-user-detail data-user-id="{{id}}">
                  Xem chi ti·∫øt ‚Üí
                </button>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>

    <!-- User Detail Panel (Full Width - Hidden by default) -->
    <div class="admin-user-detail-full" data-admin-user-detail hidden>
      <div class="admin-detail-header">
        <button type="button" class="btn-back" data-admin-back-to-list>
          ‚Üê Quay l·∫°i danh s√°ch
        </button>
      </div>
      
      <div class="admin-user-card">
        <div class="admin-user-summary">
          <div class="user-info-main">
            <h3 data-admin-user-name>Ch·ªçn ng∆∞·ªùi d√πng</h3>
            <p data-admin-user-email>‚Äî</p>
          </div>
          <div class="admin-user-tags">
            <span class="role-badge" data-admin-user-role>‚Äî</span>
            <span class="status-badge" data-admin-user-status>‚Äî</span>
          </div>
        </div>
        <div class="admin-user-actions" data-admin-user-actions hidden>
          <button type="button" class="btn secondary" data-admin-user-reset-password>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            Reset m·∫≠t kh·∫©u
          </button>
          <button type="button" class="btn danger" data-admin-user-ban>Kho√° t√†i kho·∫£n</button>
          <button type="button" class="btn success" data-admin-user-unban hidden>M·ªü kho√° t√†i kho·∫£n</button>
        </div>
      </div>

      <div class="admin-user-products-section">
        <p class="admin-user-placeholder" data-admin-user-placeholder>
          ƒêang t·∫£i d·ªØ li·ªáu...
        </p>
        <div class="admin-user-products" data-admin-user-products hidden>
          <div class="admin-user-products-header">
            <h4 data-admin-user-products-title>Qu·∫£n l√≠ ho·∫°t ƒë·ªông</h4>
            <p data-admin-user-products-description>G·ª° s·∫£n ph·∫©m vi ph·∫°m ƒë·ªÉ d·ª´ng hi·ªÉn th·ªã tr√™n s√†n ƒë·∫•u gi√°.</p>
          </div>
          <div class="admin-products-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>S·∫£n ph·∫©m</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>Gi√° hi·ªán t·∫°i</th>
                  <th>L∆∞·ª£t ƒë·∫•u</th>
                  <th>K·∫øt th√∫c</th>
                  <th>Thao t√°c</th>
                </tr>
              </thead>
              <tbody data-admin-user-products-body></tbody>
            </table>
          </div>
        </div>

        <!-- Seller's bidding products (shown only for sellers) -->
        <div class="admin-user-bidding-products" data-admin-user-bidding-products hidden>
          <div class="admin-user-products-header">
            <h4>C√°c phi√™n ƒë·∫•u gi√° ƒë√£ tham gia</h4>
            <p>Danh s√°ch s·∫£n ph·∫©m m√† ng∆∞·ªùi b√°n n√†y ƒë√£ ra gi√°.</p>
          </div>
          <div class="admin-products-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>S·∫£n ph·∫©m</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>Gi√° hi·ªán t·∫°i</th>
                  <th>Gi√° ƒë√£ ƒë·∫∑t</th>
                  <th>L∆∞·ª£t ƒë·∫•u</th>
                  <th>K·∫øt th√∫c</th>
                </tr>
              </thead>
              <tbody data-admin-user-bidding-body></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>