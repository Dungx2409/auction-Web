<section id="profile" class="account-section account-profile">
  {{#if showUpgradeSuccessNotification}}
  <div class="upgrade-success-banner" data-upgrade-success-banner>
    <div class="upgrade-success-content">
      <span class="upgrade-success-icon">ğŸ‰</span>
      <div class="upgrade-success-text">
        <strong>ChÃºc má»«ng! Báº¡n Ä‘Ã£ trá»Ÿ thÃ nh NgÆ°á»i bÃ¡n</strong>
        <p>TÃ i khoáº£n cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c nÃ¢ng cáº¥p thÃ nh cÃ´ng. Giá» Ä‘Ã¢y báº¡n cÃ³ thá»ƒ Ä‘Äƒng sáº£n pháº©m Ä‘áº¥u giÃ¡ vÃ  báº¯t Ä‘áº§u kinh doanh.</p>
      </div>
      <button type="button" class="upgrade-success-close" data-upgrade-success-close aria-label="ÄÃ³ng">âœ•</button>
    </div>
    <a href="/account/products" class="btn primary upgrade-success-action">Báº¯t Ä‘áº§u Ä‘Äƒng sáº£n pháº©m</a>
  </div>
  {{/if}}

  <header class="section-header">
    <h2>ThÃ´ng tin cÃ¡ nhÃ¢n</h2>
    <p>Cáº­p nháº­t thÃ´ng tin liÃªn há»‡ vÃ  tÃªn hiá»ƒn thá»‹ cá»§a báº¡n.</p>
  </header>

  <div class="account-panel">
    <div class="account-panel-main">
      {{#if profileFlash}}
        <div class="alert alert-{{profileFlash.type}}">{{profileFlash.message}}</div>
      {{/if}}

      <form method="post" action="/account/profile" class="account-form">
        <div class="account-form-grid">
          <div class="form-field {{#if profileErrors.name}}has-error{{/if}}">
            <label for="profile-name">Há» vÃ  tÃªn</label>
            <input id="profile-name" type="text" name="name" value="{{profileForm.name}}" required data-min-length="2" data-max-length="100" />
            {{#if profileErrors.name}}<span class="field-error">{{profileErrors.name}}</span>{{/if}}
        </div>

          <div class="form-field">
            <label for="profile-email">Email</label>
            <input id="profile-email" type="email" value="{{profileForm.email}}" disabled />
            <p class="field-hint">Email Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘Äƒng nháº­p vÃ  khÃ´ng thá»ƒ thay Ä‘á»•i.</p>
          </div>
          <div class="form-field {{#if profileErrors.address}}has-error{{/if}}">
            <label for="profile-address">Äá»‹a chá»‰</label>
            <textarea id="profile-address" name="address" rows="3">{{profileForm.address}}</textarea>
            {{#if profileErrors.address}}<span class="field-error">{{profileErrors.address}}</span>{{/if}}
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn primary">Cáº­p nháº­t thÃ´ng tin</button>
        </div>
      </form>

      {{#if accountRatings}}
      <section class="account-card rating-history-card">
        <div class="rating-history-header">
          <div>
            <h3>ÄÃ¡nh giÃ¡ gáº§n Ä‘Ã¢y</h3>
            <p>Xem chi tiáº¿t cÃ¡c láº§n báº¡n Ä‘Æ°á»£c cháº¥m Ä‘iá»ƒm vÃ  lá»i nháº­n xÃ©t tá»« ngÆ°á»i bÃ¡n.</p>
          </div>
          <span class="rating-history-total">{{accountRatings.summary.total}} lÆ°á»£t</span>
        </div>

        {{#if accountRatings.history.length}}
        <ul class="rating-timeline">
          {{#each accountRatings.history}}
          <li class="rating-timeline__item {{#if (gt score 0)}}is-positive{{else}}is-negative{{/if}}">
            <div class="rating-timeline__head">
              <div class="rating-reviewer">
                <div class="rating-avatar">
                  <i class="bi bi-person-circle" aria-hidden="true"></i>
                </div>
                <div class="rating-reviewer__details">
                  <p class="rating-reviewer__name">{{#if reviewer}}{{reviewer.name}}{{else}}NgÆ°á»i dÃ¹ng áº©n danh{{/if}}</p>
                  <p class="rating-reviewer__date">{{formatDate createdAt 'DD [thÃ¡ng] MM, YYYY'}}</p>
                  {{#if product}}
                    <a href="/products/{{product.id}}" class="rating-reviewer__product">Sáº£n pháº©m: {{product.title}}</a>
                  {{/if}}
                </div>
              </div>
              <div class="rating-chip" aria-label="Äiá»ƒm Ä‘Ã¡nh giÃ¡">
                <span class="rating-chip__icon">{{#if (gt score 0)}}ğŸ‘{{else}}ğŸ‘{{/if}}</span>
                <span class="rating-chip__value">{{#if (gt score 0)}}+1{{else}}-1{{/if}}</span>
              </div>
            </div>
            <div class="rating-comment-bubble">
              {{#if comment}}{{comment}}{{else}}NgÆ°á»i Ä‘Ã¡nh giÃ¡ khÃ´ng Ä‘á»ƒ láº¡i ghi chÃº.{{/if}}
            </div>
          </li>
          {{/each}}
        </ul>
        {{else}}
        <p class="rating-empty-state">Báº¡n chÆ°a nháº­n Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ nÃ o.</p>
        {{/if}}
      </section>
      {{/if}}
    </div>

    <aside class="account-panel-aside">
      <div class="account-card">
        <h3>Há»“ sÆ¡ cá»§a báº¡n</h3>
        <ul class="account-info-list">
          <li><span>Email</span><strong>{{user.email}}</strong></li>
          <li><span>Äá»‹a chá»‰</span><strong>{{#if user.address}}{{user.address}}{{else}}ChÆ°a cáº­p nháº­t{{/if}}</strong></li>
          <li><span>NgÃ y tham gia</span><strong>{{formatDate user.createdAt 'DD/MM/YYYY'}}</strong></li>
          <li><span>Vai trÃ²</span>
            <strong>
              {{#if roles.length}}
                {{#each roles}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
              {{else}}
                thÃ nh viÃªn
              {{/if}}
            </strong>
          </li>
        </ul>
      </div>

      {{#if accountRatings}}
      <div class="account-card account-card--ratings">
        <h3>Äiá»ƒm Ä‘Ã¡nh giÃ¡</h3>
        <div class="rating-summary">
          <div class="rating-score">
            <span class="rating-score__value">
              {{#if accountRatings.summary.scorePercent}}{{accountRatings.summary.scorePercent}}%{{else}}â€”{{/if}}
            </span>
            <span class="rating-score__label">Tá»‰ lá»‡ tÃ­ch cá»±c</span>
          </div>
          <div class="rating-metrics">
            <div class="rating-metric">
              <span>ğŸ‘ TÃ­ch cá»±c</span>
              <strong>{{accountRatings.summary.positive}}</strong>
            </div>
            <div class="rating-metric">
              <span>ğŸ‘ TiÃªu cá»±c</span>
              <strong>{{accountRatings.summary.negative}}</strong>
            </div>
            <div class="rating-metric">
              <span>Tá»•ng lÆ°á»£t</span>
              <strong>{{accountRatings.summary.total}}</strong>
            </div>
          </div>
        </div>
        <p class="rating-summary-note">Äiá»ƒm Ä‘Æ°á»£c tÃ­nh tá»« táº¥t cáº£ lÆ°á»£t Ä‘Ã¡nh giÃ¡ Ä‘Ã£ hoÃ n táº¥t.</p>
      </div>
      {{/if}}

      {{#if isBidder}}
      {{#unless isSeller}}
      <div class="account-card account-card--upgrade" data-upgrade-section>
        <h3>Trá»Ÿ thÃ nh NgÆ°á»i bÃ¡n</h3>
        <p class="upgrade-card-description">NÃ¢ng cáº¥p tÃ i khoáº£n Ä‘á»ƒ Ä‘Äƒng sáº£n pháº©m Ä‘áº¥u giÃ¡ vÃ  báº¯t Ä‘áº§u kinh doanh.</p>
        
        {{#if bidder.upgradeRequest}}
          {{#if (eq bidder.upgradeRequest.status 'pending')}}
            <div class="upgrade-status upgrade-status--pending">
              <span class="upgrade-status__icon">â³</span>
              <div class="upgrade-status__content">
                <strong>Äang chá» duyá»‡t</strong>
                <small>Gá»­i lÃºc {{formatDate bidder.upgradeRequest.requestDate 'DD/MM/YYYY HH:mm'}}</small>
              </div>
            </div>
          {{else if (eq bidder.upgradeRequest.status 'rejected')}}
            <div class="upgrade-status upgrade-status--rejected">
              <span class="upgrade-status__icon">âœ•</span>
              <div class="upgrade-status__content">
                <strong>ÄÃ£ bá»‹ tá»« chá»‘i</strong>
                {{#if bidder.upgradeRequest.adminNote}}
                  <small>{{bidder.upgradeRequest.adminNote}}</small>
                {{/if}}
              </div>
            </div>
            <button type="button" class="btn primary upgrade-btn" data-upgrade-request-btn>
              Gá»­i láº¡i yÃªu cáº§u
            </button>
          {{/if}}
        {{else}}
          <ul class="upgrade-benefits-mini">
            <li>âœ“ ÄÄƒng sáº£n pháº©m Ä‘áº¥u giÃ¡</li>
            <li>âœ“ Quáº£n lÃ½ Ä‘Æ¡n hÃ ng</li>
            <li>âœ“ Nháº­n thanh toÃ¡n an toÃ n</li>
          </ul>
          <button type="button" class="btn primary upgrade-btn" data-upgrade-request-btn>
            YÃªu cáº§u nÃ¢ng cáº¥p
          </button>
        {{/if}}
      </div>
      {{/unless}}
      {{/if}}
    </aside>
  </div>
</section>
