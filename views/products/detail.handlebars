<article class="product-detail">
  <div class="product-media">
    <div class="gallery">
      <img class="main" src="{{product.images.[0]}}" alt="{{product.title}}" />
      <div class="thumbs">
        {{#each product.images}}
        <img src="{{this}}" alt="{{../product.title}} thumbnail" />
        {{/each}}
      </div>
    </div>

    <section class="media-tabs" data-product-tabs>
      <div class="media-tabs__nav" role="tablist">
        <button
          type="button"
          class="media-tab is-active"
          data-tab="seller"
          role="tab"
          aria-selected="true"
        >
          Th√¥ng tin ng∆∞·ªùi b√°n
        </button>
        <button
          type="button"
          class="media-tab"
          data-tab="shipping"
          role="tab"
          aria-selected="false"
        >
          V·∫≠n chuy·ªÉn & thanh to√°n
        </button>
      </div>

      <div class="media-tabs__panel is-active" data-tab-panel="seller" role="tabpanel">
        <h3>Ng∆∞·ªùi b√°n {{maskName product.seller.name}}</h3>
        <ul>
          <li>ƒê√°nh gi√°: {{product.seller.ratingPlus}} üëç / {{product.seller.ratingMinus}} üëé
            ({{product.seller.ratingScore}}%)</li>
          <li>Ph·∫£n h·ªìi trong: {{product.seller.responseTime}}</li>
          <li>Huy hi·ªáu: {{#each product.seller.badges}}<span class="badge">{{this}}</span>{{/each}}</li>
        </ul>
      </div>

      <div class="media-tabs__panel" data-tab-panel="shipping" role="tabpanel" hidden>
        <h3>V·∫≠n chuy·ªÉn & thanh to√°n</h3>
        <p><strong>Giao h√†ng:</strong> {{#each product.shippingOptions}}<span>{{this}}</span>{{#unless @last}},
          {{/unless}}{{/each}}</p>
        <p><strong>Thanh to√°n:</strong> {{#each product.paymentMethods}}<span>{{this}}</span>{{#unless @last}},
          {{/unless}}{{/each}}</p>
        <p><strong>Ng√†y ƒëƒÉng:</strong> {{formatDate product.startDate}} ({{relativeTime product.startDate}})</p>
      </div>
    </section>
  </div>
  <div class="info">
    <h1>{{product.title}}</h1>
    <div class="price-block">
      <span class="price-current">{{formatCurrency product.currentPrice}}</span>
      {{#if product.buyNowPrice}}
      <span class="price-buy">Mua ngay {{formatCurrency product.buyNowPrice}}</span>
      {{/if}}
    </div>
    <dl class="summary">
      <div>
        <dt>Ng∆∞·ªùi ƒëang d·∫´n</dt>
        <dd data-bid-leader>{{maskName product.highestBidder.name}} ({{percent product.highestBidder.ratingPlus (add
          product.highestBidder.ratingPlus product.highestBidder.ratingMinus)}})</dd>
      </div>
      <div>
        <dt>L∆∞·ª£t ra gi√°</dt>
        <dd data-bid-count>{{product.bidCount}}</dd>
      </div>
      <div>
        <dt>Y√™u th√≠ch</dt>
        <dd>{{product.watchers}}</dd>
      </div>
    </dl>

    <div class="time-left" data-enddate="{{product.endDate}}">
      {{#if auctionClosed}}
        Phi√™n ƒë·∫•u gi√° ƒë√£ k·∫øt th√∫c{{#if product.endDate}} ({{formatDate product.endDate}}){{/if}}
      {{else}}
        Th·ªùi gian c√≤n l·∫°i: <span class="countdown">--:--:--</span>
      {{/if}}
    </div>

    {{#if auctionClosed}}
    <div class="auction-status-banner" role="status">
      <strong>Kh√¥ng th·ªÉ ti·∫øp t·ª•c ƒë·∫∑t gi√°</strong>
      <p>
        {{#if (eq auctionClosedReason 'time')}}S·∫£n ph·∫©m ƒë√£ h·∫øt th·ªùi gian ƒë·∫•u gi√°.{{else}}Phi√™n ƒë·∫•u gi√° ƒë√£ ƒë∆∞·ª£c ng∆∞·ªùi b√°n ƒë√≥ng l·∫°i.{{/if}}
      </p>
    </div>
    {{/if}}

    {{#if bidContext}}
    <section class="bidding-panel" aria-labelledby="bidding-panel-title">
      <div class="bid-panel-header">
        <h2 id="bidding-panel-title">ƒê·∫∑t gi√°</h2>
        <p>Gi√° g·ª£i √Ω ƒë∆∞·ª£c t√≠nh b·∫±ng gi√° hi·ªán t·∫°i c·ªông v·ªõi b∆∞·ªõc gi√° ng∆∞·ªùi b√°n thi·∫øt l·∫≠p.</p>
      </div>

      <div class="bid-price-grid">
        <article class="bid-price-card">
          <span>Gi√° hi·ªán t·∫°i</span>
          <strong data-current-price>{{#if bidContext.currentPrice}}{{formatCurrency bidContext.currentPrice}}{{else}}‚Äî{{/if}}</strong>
        </article>
        <article class="bid-price-card">
          <span>Gi√° g·ª£i √Ω</span>
          <strong data-suggested-price>{{#if bidContext.suggestedBid}}{{formatCurrency bidContext.suggestedBid}}{{else}}‚Äî{{/if}}</strong>
          {{#if bidContext.bidStep}}
          <small>B∆∞·ªõc gi√° t·ªëi thi·ªÉu {{formatCurrency bidContext.bidStep}}</small>
          {{/if}}
        </article>
      </div>

      <div class="bid-entry">
        <label for="bid-amount-{{product.id}}">Nh·∫≠p gi√° b·∫°n mu·ªën ƒë·∫∑t</label>
        <div class="bid-entry-control">
          <span>‚Ç´</span>
          <input
            id="bid-amount-{{product.id}}"
            type="text"
            name="bidAmount"
            inputmode="numeric"
            pattern="[0-9]*"
            {{#if bidContext.suggestedBid}}value="{{bidContext.suggestedBid}}" data-initial-value="{{bidContext.suggestedBid}}"{{/if}}
            {{#if bidContext.nextMinimumBid}}data-min-bid="{{bidContext.nextMinimumBid}}"{{/if}}
            {{#if bidContext.bidStep}}data-bid-step="{{bidContext.bidStep}}"{{/if}}
            data-base-amount="{{bidContext.bidBase}}"
            {{#unless bidContext.canBid}}disabled{{/unless}}
            data-bid-input
          />
        </div>
      </div>

      <div class="bid-notices">
        {{#if bidContext.requiresLogin}}
          <p class="bid-notice bid-notice--muted">ƒêƒÉng nh·∫≠p ƒë·ªÉ tham gia ƒë·∫•u gi√° v√† theo d√µi s·∫£n ph·∫©m.</p>
        {{/if}}
        {{#if bidContext.showRatingNotice}}
          <p class="bid-notice bid-notice--warning">{{bidContext.ratingRuleMessage}}</p>
        {{/if}}
        {{#if bidContext.showExceptionNote}}
          <p class="bid-notice bid-notice--info">B·∫°n ch∆∞a c√≥ ƒë√°nh gi√° nh∆∞ng ng∆∞·ªùi b√°n ƒë√£ cho ph√©p t√†i kho·∫£n m·ªõi ƒë·∫∑t gi√°.</p>
        {{/if}}
        {{#if bidContext.ratingPercent}}
          <p class="bid-notice bid-notice--meta">ƒêi·ªÉm hi·ªán t·∫°i: {{bidContext.ratingPercent}}% ({{bidContext.ratingPlus}} / {{add bidContext.ratingPlus bidContext.ratingMinus}} l·∫ßn ƒë√°nh gi√°)</p>
        {{/if}}
      </div>

      <div class="bid-button-row">
        <button
          type="button"
          class="btn primary btn-pill"
          data-bid-trigger
          data-product-id="{{product.id}}"
          {{#if bidContext.suggestedBid}}data-suggested-bid="{{bidContext.suggestedBid}}"{{/if}}
          {{#if bidContext.bidStep}}data-bid-step="{{bidContext.bidStep}}"{{/if}}
          {{#if bidContext.nextMinimumBid}}data-min-bid="{{bidContext.nextMinimumBid}}"{{/if}}
          {{#unless bidContext.canBid}}disabled{{/unless}}
        >
          X√°c nh·∫≠n ƒë·∫∑t gi√°
        </button>
        <button
          type="button"
          class="watchlist-button watchlist-button--group btn-pill{{#if product.isWatching}} is-watching{{/if}}"
          data-product-id="{{product.id}}"
          data-watch-state="{{#if product.isWatching}}watching{{else}}idle{{/if}}"
          aria-pressed="{{#if product.isWatching}}true{{else}}false{{/if}}"
          aria-label="{{#if product.isWatching}}B·ªè l∆∞u {{product.title}}{{else}}L∆∞u {{product.title}} v√†o danh s√°ch y√™u th√≠ch{{/if}}"
        >
          <span class="watchlist-heart" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="presentation" focusable="false">
              <path d="M12 21.35l-1.45-1.32C6 15.36 3 12.28 3 8.5 3 6 5 4 7.5 4c1.74 0 3.41 1 4.5 2.44C13.59 5 15.26 4 17 4c2.5 0 4.5 2 4.5 4.5 0 3.78-3 6.86-7.55 11.54L12 21.35z" />
            </svg>
          </span>
          <span class="watch-count">{{#if product.watchers}}{{product.watchers}}{{else}}0{{/if}}</span>
        </button>
      </div>
    </section>
    {{/if}}

    <div class="actions actions--qa">
      <button class="btn tertiary" type="button" data-scroll-target="#qa-thread">H·ªèi v√† ƒê√°p</button>
    </div>

  </div>
</article>

<div class="bid-confirm-modal" data-bid-modal data-product-id="{{product.id}}" hidden>
  <div class="bid-confirm-modal__overlay" data-modal-overlay data-modal-close></div>
  <div class="bid-confirm-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="bid-modal-title">
    <header class="bid-confirm-modal__header">
      <h3 id="bid-modal-title">X√°c nh·∫≠n ƒë·∫∑t gi√°</h3>
      <button type="button" class="modal-close" data-modal-close aria-label="ƒê√≥ng">&times;</button>
    </header>
    <p>B·∫°n s·∫Øp ƒë·∫∑t gi√° <strong data-bid-amount>‚Äî</strong> cho <em>{{product.title}}</em>.</p>
    <p class="modal-note">H·ªá th·ªëng s·∫Ω ghi nh·∫≠n sau khi b·∫°n x√°c nh·∫≠n. Vui l√≤ng ki·ªÉm tra l·∫°i s·ªë ti·ªÅn.</p>
    <div class="modal-actions">
      <button type="button" class="btn tertiary" data-modal-close>Hu·ª∑</button>
      <button type="button" class="btn primary" data-modal-confirm>ƒê·∫∑t gi√°</button>
    </div>
  </div>
</div>

<section class="product-description">
  <h2>Th√¥ng tin s·∫£n ph·∫©m</h2>
  {{{product.description}}}
  <h3>T√†i li·ªáu ƒë√≠nh k√®m</h3>
  <ul class="documents">
    {{#each product.documents}}
    <li>{{this}}</li>
    {{/each}}
  </ul>
</section>

<section class="bid-history">
  <h2>L·ªãch s·ª≠ ƒë·∫•u gi√°</h2>
  <table>
    <thead>
      <tr style="text-align: left;">
        <th>Th·ªùi ƒëi·ªÉm</th>
        <th>Ng∆∞·ªùi mua</th>
        <th>Gi√°</th>
      </tr>
    </thead>
    <tbody data-bid-history>
      {{#each product.bids}}
      <tr>
        <td>{{formatDate time}}</td>
        <td>{{maskName userName}}</td>
        <td>{{formatCurrency amount}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</section>

<section class="qa-section" id="qa-thread">
  <header class="qa-header">
    <div>
      <h2>H·ªèi & ƒë√°p</h2>
      {{!-- <p class="qa-subtitle">{{product.questions.length}} b√¨nh lu·∫≠n c√¥ng khai</p> --}}
    </div>
    {{#if qaStatus.error}}
    <div class="qa-alert qa-alert--error">
      {{#if (eq qaStatus.error 'empty')}}Vui l√≤ng nh·∫≠p n·ªôi dung c√¢u h·ªèi.{{/if}}
      {{#if (eq qaStatus.error 'emptyAnswer')}}Vui l√≤ng nh·∫≠p n·ªôi dung ph·∫£n h·ªìi.{{/if}}
      {{#if (eq qaStatus.error 'owner')}}B·∫°n l√† ng∆∞·ªùi b√°n c·ªßa s·∫£n ph·∫©m n√†y n√™n kh√¥ng th·ªÉ ƒë·∫∑t c√¢u h·ªèi.{{/if}}
      {{#if (eq qaStatus.error 'notSeller')}}Ch·ªâ ng∆∞·ªùi b√°n m·ªõi ƒë∆∞·ª£c tr·∫£ l·ªùi c√¢u h·ªèi.{{/if}}
      {{#if (eq qaStatus.error 'notfound')}}Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi ƒë·ªÉ tr·∫£ l·ªùi.{{/if}}
    </div>
    {{/if}}
    {{#if qaStatus.success}}
    <div class="qa-alert qa-alert--success">
      {{#if (eq qaStatus.success 'question')}}ƒê√£ g·ª≠i c√¢u h·ªèi t·ªõi ng∆∞·ªùi b√°n.{{/if}}
      {{#if (eq qaStatus.success 'answer')}}ƒê√£ g·ª≠i ph·∫£n h·ªìi ƒë·∫øn ng∆∞·ªùi mua.{{/if}}
    </div>
    {{/if}}
  </header>

  <div class="qa-composer">
    {{#if canAskQuestion}}
    <form action="/products/{{product.id}}/questions" method="post" class="qa-form" data-qa-form="question">
      <div class="qa-avatar" aria-hidden="true" data-letter="{{initial currentUser.name}}"></div>
      <div class="qa-form-body">
        <textarea name="question" rows="2" placeholder="H·ªèi ng∆∞·ªùi b√°n v·ªÅ s·∫£n ph·∫©m..."
          required data-auto-resize></textarea>
        <div class="qa-form-actions">
          <button type="submit" class="btn primary">G·ª≠i c√¢u h·ªèi</button>
        </div>
      </div>
    </form>
    {{else if isAuthenticated}}
    {{else}}
    <div class="qa-placeholder">
      <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ tr√≤ chuy·ªán v·ªõi ng∆∞·ªùi b√°n.</p>
      <a class="btn secondary" href="/auth/login?returnUrl=/products/{{product.id}}">ƒêƒÉng nh·∫≠p ngay</a>
    </div>
    {{/if}}
  </div>

  <div class="qa-thread">
    {{#if product.questions.length}}
    {{#each product.questions}}
    <article class="qa-comment" id="comment-{{id}}">
      <div class="qa-avatar" aria-hidden="true" data-letter="{{initial askedBy}}"></div>
      <div class="qa-bubble">
        <div class="qa-meta">
          <strong>{{maskName askedBy}}</strong>
          <span>{{relativeTime askedAt}}</span>
        </div>
        <p class="qa-question">{{question}}</p>
        <div class="qa-actions">
          <span>{{answers.length}} ph·∫£n h·ªìi</span>
          {{#if @root.canAnswerQuestion}}
          <button type="button" class="qa-action-link" data-action="toggle-reply" data-target="reply-{{id}}">Tr·∫£
            l·ªùi</button>
          {{/if}}
        </div>
        <div class="qa-replies">
          {{#if answers.length}}
          {{#each answers}}
          <article class="qa-reply">
            <div class="qa-avatar qa-avatar--small" aria-hidden="true" data-letter="{{initial answeredBy}}"></div>
            <div class="qa-bubble">
              <div class="qa-meta">
                <strong>{{maskName answeredBy}}</strong>
                <span>{{relativeTime answeredAt}}</span>
              </div>
              <p class="qa-answer">{{text}}</p>
            </div>
          </article>
          {{/each}}
          {{else}}
            {{#if @root.canAnswerQuestion}}
            <p class="qa-reply-placeholder">B·∫°n ch∆∞a ph·∫£n h·ªìi c√¢u h·ªèi n√†y.</p>
            {{/if}}
          {{/if}}
        </div>
        {{#if @root.canAnswerQuestion}}
        <form class="qa-reply-form" id="reply-{{id}}" action="/products/{{@root.product.id}}/questions/{{id}}/answers"
          method="post" hidden>
          <textarea name="answer" rows="2" placeholder="G·ª≠i ph·∫£n h·ªìi t·ªõi ng∆∞·ªùi mua..." required data-auto-resize></textarea>
          <div class="qa-form-actions">
            <span>Ph·∫£n h·ªìi s·∫Ω hi·ªÉn th·ªã c√¥ng khai.</span>
            <button type="submit" class="btn primary">G·ª≠i ph·∫£n h·ªìi</button>
          </div>
        </form>
        {{/if}}
      </div>
    </article>
    {{/each}}
    {{else}}
    <div class="qa-placeholder">
      <p>H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë·∫∑t c√¢u h·ªèi cho s·∫£n ph·∫©m n√†y!</p>
    </div>
    {{/if}}
  </div>
</section>

{{#if relatedProducts.length}}
<section class="related-products">
  <h2>S·∫£n ph·∫©m c√πng danh m·ª•c</h2>
  <div class="product-grid">
    {{#each relatedProducts}}
    {{> product-card}}
    {{/each}}
  </div>
</section>
{{/if}}